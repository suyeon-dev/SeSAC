<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë™ì í¼(ajax, axios, fetch)</title>

    <!-- jQuery CDN -->
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>

    <!-- Axios CDN -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <h1>ë™ì í¼ ì „ì†¡ ì—°ìŠµí•˜ê¸°!</h1>
    <form name="register">
      <label for="name">ì´ë¦„:</label>
      <input type="text" name="name" id="name" required />

      <br />
      <span>ì„±ë³„:</span>
      <!-- (!) ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ requiredí•´ë„ ì‘ë™í•¨ -->
      <input type="radio" id="male" name="gender" value="ë‚¨ì„±" required />
      <label for="male">ë‚¨ì</label>

      <input type="radio" id="female" name="gender" value="ì—¬ì„±" />
      <label for="female">ì—¬ì</label>

      <br />
      <br />
      <button type="button" onClick="ajaxGet()">Ajax GET ì œì¶œ</button>
      <button type="button" onCLick="ajaxPost()">Ajax POST ì œì¶œ</button>
      <br />
      <!-- axiosëŠ” promise ë°˜í™˜ -> aysnc/await ê°€ëŠ¥ -->
      <button type="button" onclick="axiosGet()">Axios GET ì œì¶œ</button>
      <button type="button" onclick="axiosPost()">Axios POST ì œì¶œ</button>
      <br />
      <button type="button" onclick="fetchGet()">Fetch GET ì œì¶œ</button>
      <button type="button" onclick="fetchPost()">Fetch POST ì œì¶œ</button>

      <br />
    </form>
    <div class="result"></div>

    <hr />
    <a href="/api">Open API ì‚¬ìš©í•´ë³´ê¸° ğŸ¾</a>
    <br />
    <a href="/practice1">ì‹¤ìŠµë¬¸ì œ1</a>
    <a href="/practice2">ì‹¤ìŠµë¬¸ì œ2</a>
    <script>
      const resultBox = document.querySelector('.result');

      /* 1. ajax */
      function ajaxGet() {
        //í¼ ì„ íƒ(formì˜ ì´ë¦„ì´ register)
        const form = document.forms['register'];

        // console.log(form);
        // console.log(form.name);
        // console.log(form.gender.length);
        // console.log(form.gender.value);

        //button type buttonì€ required ë™ì‘í•˜ì§€ ì•ŠìŒ
        // -> ìœ íš¨ì„± ê²€ì¦ ë”°ë¡œ í•´ì£¼ê¸°
        // if (form.name.value.trim() === '') {
        //   alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
        //   return;
        // }
        // if (form.gender.value === '') {
        //   alert('ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
        //   return;
        // }

        // --- ajax ìš”ì²­ -----
        //ë³´ë‚¼ ë°ì´í„° ê°ì²´ í˜•íƒœë¡œ ë§Œë“¤ê¸°
        const data = {
          name: form.name.value,
          gender: form.gender.value,
        };

        /* ajax ì‚¬ìš© */
        $.ajax({
          type: 'get',
          url: '/ajax', // formì˜ actionì— í•´ë‹¹í•˜ëŠ” ê³³ (ì–´ë–¤ ì£¼ì†Œë¡œ apië¥¼ ìš”ì²­í•˜ëŠ”ì§€)
          data: data, //ìš°ë¦¬ê°€ ë§Œë“  dataë¥¼ dataë¼ëŠ” í‚¤ì— ë‹´ì•„ ì„œë²„ë¡œ ë„˜ê²¨ì¤Œ

          //í†µì‹ ì´ ì„±ê³µí–ˆì„ ë•Œ
          success: function (res) {
            //í†µì‹  ì´í›„ì— ì¼ì–´ë‚  ì¼ë“¤
            // console.log(res);
            resultBox.textContent = `GET /ajax ìš”ì²­ ì™„ë£Œ!
            ${res.name}ì˜ ì„±ë³„ì€ ${res.gender}`;
          },

          //í†µì‹ ì´ ì‹¤íŒ¨í–ˆì„ ë•Œ
          error: function (err) {
            console.log('err', err);
          },
        });
      }

      function ajaxPost() {
        const form = document.forms['register'];
        const data = {
          name: form.name.value,
          gender: form.gender.value,
        };

        // get, post ë‘˜ ë‹¤ keyê°’ ë™ì¼
        $.ajax({
          type: 'post',
          url: '/ajax',
          data: data,
          // ë§¤ê°œë³€ìˆ˜ ì´ë¦„ì€ res, data...ìƒê´€ì—†ìŒ -> ì„œë²„ê°€ ì£¼ëŠ” ë°ì´í„° ê°’ì´ ë“¤ì–´ì˜´
          success: function (data) {
            console.log(data);
            resultBox.textContent = `POST /ajax ìš”ì²­ ì™„ë£Œ!
                ${data.name}ì˜ ì„±ë³„ì€ ${data.gender}`;
          },
          error: function (error) {
            console.log(error);
          },
        });
      }

      // --- axios ìš”ì²­ -----
      async function axiosGet() {
        const form = document.forms['register'];
        const data = {
          name: form.name.value,
          gender: form.gender.value,
        };

        //ìœ íš¨ì„± ê²€ì‚¬ - checkValidity()
        //- requiredê°€ ìˆìœ¼ë©´ ê°€ì… ì—¬ë¶€ë¥¼ ê²€ì‚¬í•´ì¤Œ
        /*
        -  Required ì†ì„±ì´ ì—†ëŠ” í•­ëª© -> ë¬´ì¡°ê±´ True ë°˜í™˜
        - required ì†ì„±ì´ ìˆëŠ” í•­ëª© ->
        : ê°€ì…ì„ í–ˆë‹¤ë©´ True ë°˜í™˜
        : ê°€ì…ì„ í•˜ì§€ ì•Šì•˜ë”°ë©´ false ë°˜í™˜
        */
        console.log(form.name.checkValidity());
        console.log(form.gender[0].checkValidity());

        if (!form.name.checkValidity()) {
          resultBox.innerText = 'ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”';
          //   resultBox.innerText = form.name.validationMessage;
          return;
        }

        if (!form.gender[0].checkValidity()) {
          resultBox.innerText = 'ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”';
          return;
        }

        // ----axios ìš”ì²­ ë³´ë‚´ê¸° ------
        // 1. Promise : then ~ catch ì‚¬ìš© (ì¸ì: ê°ì²´{ } )
        // - get ìš”ì²­ì¼ ë•ŒëŠ” paramsì— ë‹´ì•„ì„œ ìš”ì²­
        // axios({
        //   method: 'get',
        //   url: '/axios',
        //   params: data,
        // })
        //   .then(function (res) {
        //     //í†µì‹ ì— ì„±ê³µí–ˆì„ ë•Œ
        //     console.log(res);
        //     //{name: 'sueyon', gender:'ì—¬ì„±'} ê·¸ëŒ€ë¡œ ì¶œë ¥ë˜ì§€ ì•ŠìŒ -> console.log í™•ì¸í•´ë³´ê¸°
        //     // console.log(res.data); //ì„œë²„ì—ì„œ ì¤€ ë°ì´í„°
        //     // console.log(res.status);
        //     // console.log(res.statusText);
        //     // console.log(res.headers);
        //     // console.log(res.config);

        //     resultBox.textContent = `GET /axios ìš”ì²­ ì™„ë£Œ!
        //   ${res.data.name}ì˜ ì„±ë³„ì€ ${res.data.gender}`;
        //     resultBox.style.color = 'green';
        //   })
        //   .catch(function (err) {
        //     //í†µì‹ ì— ì‹¤íŒ¨í–ˆì„ ë•Œ
        //     console.error('error!!!');
        //     console.error(err);
        //   });

        // 2. async-await
        // - ì—ëŸ¬ì²˜ë¦¬ë¥¼ try~catchë¬¸ì„ ì‚¬ìš©í•´ì„œ í•´ì£¼ëŠ” ê²Œ ì¢‹ë‹¤!
        // - params ëŒ€ì‹  queryë¡œ ë³´ë‚´ë³´ê¸°
        try {
          const response = await axios({
            method: 'get',
            url: `/axios?name=${data.name}&gender=${data.gender}`,
          });
          console.log('axios get', response);
          // console.log(response.data);
          const { name, gender } = response.data;
          resultBox.textContent = `${name}ì˜ ì„±ë³„ì€ ${gender}`;
          resultBox.style.color = 'green';
        } catch (err) {
          console.error(err);
        }
      }

      async function axiosPost() {
        const form = document.forms['register'];
        const data = {
          name: form.name.value,
          gender: form.gender.value,
        };

        try {
          const res = await axios({
            // PostëŠ” ë°˜ë“œì‹œ Keyê°’(data)ì— ìœ„ì—ì„œ ì„ ì–¸í•œ dataë¥¼ ë‹´ì•„ ë³´ë‚´ì•¼í•¨
            method: 'post',
            url: '/axios',
            data: data,
          });
          console.log(res);
          console.log('ì‹¤ì œ ë°ì´í„°', res.data);
          //êµ¬ì¡°ë¶„í•´í• ë‹¹
          const { name: ì´ë¦„, gender: ì„±ë³„ } = res.data;
          resultBox.textContent = `POST /axios ìš”ì²­ ì™„ë£Œ!
          ${ì´ë¦„}ì˜ ì„±ë³„ì€ ${ì„±ë³„}`;
          resultBox.style.color = 'hotpink';
        } catch (err) {
          console.log(err);
        }
      }

      // --- fetch ìš”ì²­ ------
      function fetchGet() {
        const form = document.forms['register'];
        // console.log('---fetchGet', form);
        const data = {
          name: form.name.value,
          gender: form.gender.value,
        };

        //fetch ('URL', ì„¤ì •ê°’(ë°ì´í„°, í•¨ìˆ˜)
        // fetch('/fetch', {
        //   method: 'get', //í†µì‹ í•˜ê³ ìí•˜ëŠ” ë°©ì‹
        // });

        //fetchì˜ default method: GET
        fetch(`/fetch?name=${data.name}&gender=${data.gender}`)
          .then((res) => {
            console.log(res);
            //ì„œë²„ì—ì„œ ë„˜ì–´ì˜¨ ë¬¸ìì—´ ë½‘ì•„ë‚´ê¸° ìœ„í•´ text() ë©”ì„œë“œ ì‚¬ìš©
            //text(): res ê°ì²´ì—ì„œ í…ìŠ¤íŠ¸ ë³¸ë¬¸ì„ ë½‘ì•„ë‚´ê¸° ìœ„í•´/ ì‘ë‹µì„ ì½ê³  í…ìŠ¤íŠ¸ë¥¼ ë°˜í™˜
            // return res.text(); //res.send('ì‘ë‹µì™„ë£Œ')

            //json(); ê°ì²´ì—ì„œ ë³¸ë¬¸ì„ ë½‘ì•„ë‚´ê¸° ìœ„í•´ - ì‘ë‹µì„ JSON í˜•íƒœë¡œ íŒŒì‹±(ì‹¤ì œë¡œ í™•ì¸í•´ë³´ë©´ Javascript ê°ì²´ í˜•íƒœë¡œ ë°˜í™˜
            return res.json(); //ì‘ë‹µ ë³¸ë¬¸ì„ JSONì—ì„œ JS ê°ì²´ë¡œ ë°˜í™˜
          })
          .then((res) => {
            console.log(res);
            resultBox.textContent = `GET /fetch ìš”ì²­ ì™„ë£Œ! ${res.name}ì˜ ì„±ë³„ì€ ${res.gender}`;
            resultBox.style.color = 'limegreen';
          })
          .catch((err) => {
            console.error('err', err);
          });
      }

      async function fetchPost() {
        const form = document.forms['register'];
        const data = {
          name: form.name.value,
          gender: form.gender.value,
        };

        //ë°ì´í„° ìš”ì²­ ì‘ì—… (HTTP ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆëŠ” API :fetch(ê²½ë¡œ, ìš”ì²­ ë‚´ìš©))
        try {
          const res = await fetch('/fetch', {
            method: 'post',
            body: JSON.stringify(data), //ë°ì´í„°(JSê°ì²´)->JSON ë¬¸ìì—´ë¡œ ë³€í™˜í•´ì„œ ì„œë²„ë¡œ ì „ì†¡ : ì„œë²„ëŠ” ì´ ë°ì´í„°ë¥¼ JSONìœ¼ë¡œ íŒŒì‹±í•´ì•¼í•¨
            headers: {
              'Content-Type': 'application/json', //ìš”ì²­í—¤ë”: JSON ë°ì´í„°ì„ì„ ëª…ì‹œ
            },
          });
          console.log('fetchPost', res); //fetchê°€ ë°˜í™˜í•˜ëŠ” Response ê°ì²´ (=HTTP ì‘ë‹µ ì „ì²´)

          //json(), text() : ì‹œê°„ ê±¸ë¦¬ëŠ” ì‘ì—…
          const result = await res.json(); //JSON -> ê°ì²´
          console.log('res.json', result); //{name: 'ì‚°íƒ€', gender: 'ë‚¨ì„±'}
          const { name, gender } = result;
          resultBox.textContent = `
          POST /fetch ìš”ì²­ ê²°ê³¼:
          ${name}ì˜ ì„±ë³„ì€ ${gender}`;
          resultBox.style.color = 'gray';
        } catch (err) {
          console.error(err);
        }
      }
    </script>
  </body>
</html>
